<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BGP Configuration Generator</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }

        input[type="text"],
        input[type="number"] {
            width: calc(100% - 10px); /* Account for padding */
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; /* Include padding in width */
        }

        .network-entry {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        input[type="submit"] {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        input[type="submit"]:hover {
            background-color: #0069d9;
        }

        #networks {
            margin-bottom: 20px; /* Space between networks and submit button */
        }
        .bgp-group {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .bgp-group {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .remove-group-button {
            background-color: #d9534f; /* Red */
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 5px; /* Add some top margin */
            display: inline-block; /* Make it inline with the title */
            vertical-align: middle; /* Align vertically with the title */
        }

        .remove-group-button:hover {
            background-color: #c9302c;
        }
    </style>
</head>
<body>
    <h1>BGP Configuration Form</h1>
    <form id="bgpForm" method="POST" action="/generate-bgp-config">

        <label for="router_id">Router ID (Same for all groups):</label><br>
        <input type="text" id="router_id" name="router_id" required><br><br>

        <div id="bgp-groups-container">
            <div class="bgp-group">
                <h2>BGP Group 1 <button type="button" class="remove-group-button" onclick="removeBGPGroup(this)">Remove</button></h2>
                <label for="group_name_1">BGP Group Name:</label><br>
                <input type="text" id="group_name_1" name="group_name[]" required><br><br>

                <label for="local_address_1">Local Address:</label><br>
                <input type="text" id="local_address_1" name="local_address[]" required><br><br>

                <label for="peer_as_1">Peer AS Number:</label><br>
                <input type="number" id="peer_as_1" name="peer_as[]" required><br><br>

                <label for="peer_address_1">Peer Address:</label><br>
                <input type="text" id="peer_address_1" name="peer_address[]" required><br><br>

                <h2>Networks to Advertise:</h2>
                <div id="networks_1">
                    <div class="network-entry">
                        <label for="network_name_1_1">Network Name:</label><br>
                        <input type="text" id="network_name_1_1" name="network_name_1[]" required><br><br>

                        <label for="network_prefix_1_1">Network Prefix:</label><br>
                        <input type="text" id="network_prefix_1_1" name="network_prefix_1[]" required><br><br>
                    </div>
                </div>
                <button type="button" onclick="addNetwork(1)">Add Network</button><br><br>
            </div>
        </div>

        <button type="button" onclick="addBGPGroup()">Add BGP Group</button><br><br>
        <button type="button" onclick="resetForm()">Reset Form</button><br><br>


        <input type="submit" value="Generate BGP Configuration">
    </form>

    <script>
        let bgpGroupCount = 1;
        let networkCounts = { 1: 1 };

        function addBGPGroup() {
            bgpGroupCount++;
            networkCounts[bgpGroupCount] = 1;

            const bgpGroupDiv = document.createElement('div');
            bgpGroupDiv.classList.add('bgp-group');
            bgpGroupDiv.innerHTML = `
                <h2>BGP Group ${bgpGroupCount} <button type="button" class="remove-group-button" onclick="removeBGPGroup(this)">Remove</button></h2>
                <label for="group_name_${bgpGroupCount}">BGP Group Name:</label><br>
                <input type="text" id="group_name_${bgpGroupCount}" name="group_name[]" required><br><br>
                <label for="local_address_${bgpGroupCount}">Local Address:</label><br>
                <input type="text" id="local_address_${bgpGroupCount}" name="local_address[]" required><br><br>
                <label for="peer_as_${bgpGroupCount}">Peer AS Number:</label><br>
                <input type="number" id="peer_as_${bgpGroupCount}" name="peer_as[]" required><br><br>
                <label for="peer_address_${bgpGroupCount}">Peer Address:</label><br>
                <input type="text" id="peer_address_${bgpGroupCount}" name="peer_address[]" required><br><br>

                <h2>Networks to Advertise:</h2>
                <div id="networks_${bgpGroupCount}">
                    <div class="network-entry">
                        <label for="network_name_${bgpGroupCount}_1">Network Name:</label><br>
                        <input type="text" id="network_name_${bgpGroupCount}_1" name="network_name_${bgpGroupCount}[]" required><br><br>
                        <label for="network_prefix_${bgpGroupCount}_1">Network Prefix:</label><br>
                        <input type="text" id="network_prefix_${bgpGroupCount}_1" name="network_prefix_${bgpGroupCount}[]" required><br><br>
                    </div>
                </div>
                <button type="button" onclick="addNetwork(${bgpGroupCount})">Add Network</button><br><br>
            `;
            document.getElementById('bgp-groups-container').appendChild(bgpGroupDiv);
        }

        function removeBGPGroup(button) {
            const bgpGroupDiv = button.parentNode.parentNode;
            bgpGroupDiv.remove();
        }

        function addNetwork(groupId) {
            networkCounts[groupId]++;
            const networkDiv = document.createElement('div');
            networkDiv.classList.add('network-entry');
            networkDiv.innerHTML = `
                <label for="network_name_${groupId}_${networkCounts[groupId]}">Network Name:</label><br>
                <input type="text" id="network_name_${groupId}_${networkCounts[groupId]}" name="network_name_${groupId}[]" required><br><br>
                <label for="network_prefix_${groupId}_${networkCounts[groupId]}">Network Prefix:</label><br>
                <input type="text" id="network_prefix_${groupId}_${networkCounts[groupId]}" name="network_prefix_${groupId}[]" required><br><br>
            `;
            document.getElementById(`networks_${groupId}`).appendChild(networkDiv);
        }

        function resetForm() {
            document.getElementById('bgpForm').reset();
            // Remove added BGP groups (keep the first one)
            const bgpGroups = document.querySelectorAll('.bgp-group');
            for (let i = 1; i < bgpGroups.length; i++) { // Start from index 1 to keep the first group
                bgpGroups[i].remove();
            }
            bgpGroupCount = 1; // Reset the counter
            networkCounts = { 1: 1 }; // Reset network counts
        }
        $(document).ready(function() {
            $("#bgpForm").submit(function(event) {
                event.preventDefault(); // Prevent default form submission

                var formData = {};  // Object to store all the form data

                formData.router_id = $("#router_id").val();

                formData.bgp_groups = [];
                $(".bgp-group").each(function(index) {
                    var groupData = {};
                    groupData.group_name = $(this).find("[name='group_name[]']").val();
                    groupData.local_address = $(this).find("[name='local_address[]']").val();
                    groupData.peer_as = $(this).find("[name='peer_as[]']").val();
                    groupData.peer_address = $(this).find("[name='peer_address[]']").val();

                    groupData.networks = [];
                    $(this).find(".network-entry").each(function() {
                        var networkData = {};
                        networkData.name = $(this).find("[name^='network_name_']").val(); // Use attribute starts with selector
                        networkData.prefix = $(this).find("[name^='network_prefix_']").val();// Use attribute starts with selector
                        groupData.networks.push(networkData);
                    });
                    formData.bgp_groups.push(groupData);
                });

                $.ajax({
                    type: "POST",
                    url: "/generate-bgp-config",  // Your Python route
                    data: JSON.stringify(formData),
                    contentType: "application/json",
                    success: function(response) {
                        alert("BGP Configuration generated and applied!"); // Or display the config
                        console.log(response.message);
                    },
                    error: function(error) {
                      console.error("Error:", error);
                      alert("An error occurred during configuration.");
                    }
                });
            });
        });
    </script>
</body>
</html>
